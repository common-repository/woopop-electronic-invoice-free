(function(_,$,wc_el_inv_admin){function createEditLink(id,appendTo,position){var edit=document.createElement("a");edit.setAttribute("id",id);edit.setAttribute("href","javascript:;");edit.innerHTML='<i class="dashicons dashicons-edit"></i>';appendTo.insertAdjacentElement(position,edit)}function createButtonSave(id,appendTo,position){var button=document.createElement("button");button.setAttribute("id",id);button.setAttribute("name",id);button.setAttribute("class","button");button.innerText=wc_el_inv_admin.text_save;appendTo.insertAdjacentElement(position,button)}function createCloseLink(id,appendTo,position){var close=document.createElement("a");close.setAttribute("id",id);close.setAttribute("href","javascript:;");close.innerHTML='<i class="dashicons dashicons-no"></i>';appendTo.insertAdjacentElement("beforeend",close)}function editInvoiceNumber(){var input=document.getElementById("wc_el_inv-settings-number_next_invoice");if(!input){return}if(""!==input.value){input.setAttribute("disabled","disabled")}createEditLink("edit_invoice_next_number",input,"afterend");var edit=document.getElementById("edit_invoice_next_number");edit.addEventListener("click",function(){edit.style.display="none";input.removeAttribute("disabled");createButtonSave("save_invoice_next_number",input,"afterend")})}function editOrderInvoiceNumber(){var inputs=document.querySelectorAll(".wc_el_inv-order_fields");if(0===inputs.length){return}_.forEach(inputs,function(input){if(""!==input.value){input.setAttribute("disabled","disabled")}});var wrapTitle=document.querySelector(".wc_el_inv__general-order h3");var fields=document.querySelector(".wc_el_inv__general-order--hidden-fields");var textData=document.querySelector(".wc_el_inv__general-order--text-data");if(wrapTitle&&fields&&textData){createEditLink("edit_invoice_next_number",wrapTitle,"beforeend");var edit=document.getElementById("edit_invoice_next_number");createCloseLink("close_invoice_next_number",wrapTitle,"beforeend");var close=document.getElementById("close_invoice_next_number");close.style.display="none";edit.addEventListener("click",function(){fields.style.display="block";textData.style.display="none";this.style.display="none";close.style.display="block";_.forEach(inputs,function(input){input.removeAttribute("disabled")})});close.addEventListener("click",function(){fields.style.display="none";textData.style.display="block";close.style.display="none";edit.style.display="";_.forEach(inputs,function(input){input.setAttribute("disabled","disabled")})})}}function editRefundInvoiceNumber(){var refundLine=document.querySelectorAll(".wc_el_inv__refund-invoice[data-order_refund_id]");var inputs=document.querySelectorAll(".wc_el_inv-order_fields");if(0===inputs.length){return}_.forEach(inputs,function(input){if(""!==input.value){input.setAttribute("disabled","disabled")}});_.forEach(refundLine,function(item,index){var wrapTitle=item.querySelector(".wc_el_inv__refund-invoice td h3");var fields=item.querySelector(".wc_el_inv__refund-invoice--hidden-fields");var textData=item.querySelector(".wc_el_inv__refund-invoice--text-data");if(wrapTitle&&fields&&textData){createEditLink("edit_refund_invoice_next_number-"+index,wrapTitle,"beforeend");var edit=document.getElementById("edit_refund_invoice_next_number-"+index);createCloseLink("close_refund_invoice_next_number-"+index,wrapTitle,"beforeend");var close=document.getElementById("close_refund_invoice_next_number-"+index);close.style.display="none";close.addEventListener("click",function(){fields.style.display="none";textData.style.display="block";close.style.display="none";edit.style.display="";_.forEach(inputs,function(input){input.setAttribute("disabled","disabled")})});edit.addEventListener("click",function(){fields.style.display="block";textData.style.display="none";this.style.display="none";close.style.display="block";_.forEach(inputs,function(input){input.removeAttribute("disabled")})})}})}function filterByDate(){var actions=[document.querySelector(".save-all"),document.querySelector(".save-all-csv"),document.querySelector(".view-all"),document.querySelector(".get-all")];if([]===actions){return}var filter=document.querySelector(".filter");if(filter){var filterHref=filter.getAttribute("href");filter.addEventListener("click",function(evt){evt.preventDefault();evt.stopImmediatePropagation();var baseHref=filterHref;var customerID="";var customer=document.getElementById("filter_customer_id");if(customer){customerID=customer.options[customer.selectedIndex].value;if(!(customerID==="")){baseHref=evt.target.href+"&customer_id="+customerID}}if("undefined"!==baseHref){var targetHref=setUrlForFilter(baseHref);if(targetHref!==filterHref&&-1!==targetHref.indexOf("date_in")){window.location=targetHref}else{alert(wc_el_inv_admin.select_date_filter)}}})}if(actions){_.forEach(actions,function(item){if(!item){return}item.addEventListener("click",function(evt){evt.preventDefault();evt.stopImmediatePropagation();var href=setUrlForFilter(evt.target.parentElement.href);window.open(href,"_blank")})})}}function parseDate(date){var dateSplit=date.split(/[^0-9]/);var DateString=dateSplit[0]+"-"+dateSplit[1]+"-"+dateSplit[2]+"T"+dateSplit[3]+":"+dateSplit[4]+":00";var dateObj=new Date(DateString.toString());return dateObj.getTime()/1e3}function setUrlForFilter(baseHref){var href;var dateIN=document.getElementById("date_in");var dateOUT=document.getElementById("date_out");if(dateIN.value||dateOUT.value){var IN=dateIN.value+" 00:00";var OUT=dateOUT.value+" 23:59";IN=IN.split(" - ").map(function(date){return parseDate(date)}).join(" - ");OUT=OUT.split(" - ").map(function(date){return parseDate(date)}).join(" - ");if(dateIN.value&&""===dateOUT.value){href=baseHref+"&date_in="+IN}if(""===dateIN.value&&dateOUT.value){href=baseHref+"&date_out="+OUT}if(dateIN.value&&dateOUT.value){href=baseHref+"&date_in="+IN+"&date_out="+OUT}}else{href=baseHref}return href}function filterCustomer(){var select=document.getElementById("filter_customer_id");if(!select){return}select.addEventListener("change",function(){window.location=window.location.href+"&customer_id="+this.value})}function filterType(){var select=document.getElementById("filter_type");if(!select){return}select.addEventListener("change",function(){window.location=window.location.href+"&type="+this.value})}function markInvoice(){var triggers=document.querySelectorAll(".mark_trigger");if(!triggers){return}_.forEach(triggers,function(trigger){trigger.addEventListener("click",function(evt){evt.preventDefault();evt.stopImmediatePropagation();var confirm=false;if(this.classList.contains("mark_as_sent")){if(window.confirm(wc_el_inv_admin.invoice_sent_confirm)){confirm=true}}else if(this.classList.contains("mark_undo")){if(window.confirm(wc_el_inv_admin.invoice_undo_confirm)){confirm=true}}if(!confirm){return}$.ajax({url:wc_el_inv_admin.ajax_url,method:"POST",cache:false,data:{action:"markInvoice",action_url:this.href,nonce:wc_el_inv_admin.ajax_nonce},beforeSend:function(){}.bind(this),complete:function(xhr,status){console.log(xhr,status)}.bind(this),error:function(xhr,status,error){console.warn("markInvoice "+error,status)}.bind(this),success:function(data,status,xhr){console.log(data);window.location.reload()}.bind(this)})})})}function refundItemControl(){var buttonRefund=document.querySelector("#woocommerce-order-items .inside .refund-items");var marks=document.querySelectorAll("#order_refunds .actions .mark_trigger");if(!marks){return}_.forEach(marks,function(mark){if(mark.classList.contains("mark_as_sent")){if(buttonRefund){buttonRefund.setAttribute("disabled",true);buttonRefund.innerText=wc_el_inv_admin.refund_item_disabled_text}}})}function invoiceItemControl(){var refundAmount=document.querySelector("#woocommerce-order-items .inside input#refund_amount");var mark=document.querySelector(".wc_el_inv__general-order .actions .mark_trigger");if(!refundAmount||!mark){return}if(mark.classList.contains("mark_as_sent")){refundAmount.setAttribute("readonly",true);refundAmount.insertAdjacentHTML("afterend",'<p id="readonly-info">'+wc_el_inv_admin.refund_amount_read_only_info_text+"</p>")}}function choiceType(){var docTypeInputs=document.querySelectorAll(".doc-type-input");if(!docTypeInputs){return}_.forEach(docTypeInputs,function(input){input.addEventListener("change",function(evt){this.parentElement.parentElement.parentElement.querySelectorAll(".choice_type--current")[0].setAttribute("value",this.value)})})}function endPointActions(){var actions=document.querySelectorAll(".action-endpoint");if(!actions){return}_.forEach(actions,function(action){action.addEventListener("click",function(evt){evt.preventDefault();evt.stopImmediatePropagation();var type=this.parentElement.querySelector(".choice_type--current");var href=this.href;if(type){href=href+"&choice_type="+type.value}window.open(href)})})}function getUrlVars(){var vars={};var parts=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value});return vars}function getUrlParam(parameter,defaultvalue){var urlparameter=defaultvalue;if(window.location.href.indexOf(parameter)>-1){urlparameter=getUrlVars()[parameter]}return urlparameter}function activeSubMenu(){var urlParam=getUrlParam("tab");var list=document.querySelectorAll("#toplevel_page_wc_el_inv-options-page ul.wp-submenu li a");if(list){list.forEach(function(item){if(item.parentElement.classList.contains("wp-first-item")){item.parentElement.remove()}item.parentElement.classList.remove("current");var href=item.getAttribute("href");if(-1!==href.indexOf(urlParam)){item.parentElement.classList.add("current")}})}}function searchOrderByID(){var searchInput=document.getElementById("wc_el_inv_order_search");var searchTrigger=document.querySelector(".wc_el_inv_order_search_trigger");if(searchInput&&searchTrigger){searchTrigger.addEventListener("click",function(evt){evt.preventDefault();evt.stopImmediatePropagation();if(""===searchInput.value){alert(wc_el_inv_admin.search_by_id)}else{window.location=searchTrigger.href+"&order_search="+searchInput.value}console.log(searchInput.value)})}}window.addEventListener("load",function(){var contentInv=$("#store_invoice-description");if(contentInv){var titleInv=$(contentInv).prev();titleInv.addClass("store_invoice_title")}var contentInvT=$("#store_invoice_transmitter-description");if(contentInvT){var titleInvT=$(contentInvT).prev();titleInvT.addClass("store_invoice_transmitter_title")}var contentOptions=$("#reverse_charge_invoice-description");if(contentOptions){var title=$(contentOptions).prev();title.addClass("reverse_charge_invoice_title")}var content=$("#reverse_charge_invoice_info-description");if(content){var trigger=$(content).prev();trigger.addClass("reverse_charge_info_trigger");trigger.append('<span class="dashicons dashicons-arrow-right-alt2"></span>');$(trigger).on("click",function(evt){content.slideToggle("slow");trigger.toggleClass("open")})}$("a.edit_address").on("click",function(evt){$(".order_data_column > p").addClass("hide")});activeSubMenu();editInvoiceNumber();editOrderInvoiceNumber();editRefundInvoiceNumber();filterCustomer();filterType();filterByDate();markInvoice();refundItemControl();invoiceItemControl();searchOrderByID();choiceType();endPointActions();$(document).ajaxComplete(function(){var refundAmount=document.querySelector("#woocommerce-order-items .inside input#refund_amount");var mark=document.querySelector(".wc_el_inv__general-order .actions .mark_trigger");if(!refundAmount||!mark){return}if(!refundAmount.hasAttribute("readonly")&&mark.classList.contains("mark_as_sent")){refundAmount.setAttribute("readonly",true);refundAmount.insertAdjacentHTML("afterend",'<p id="readonly-info">'+wc_el_inv_admin.refund_amount_read_only_info_text+"</p>")}else if(refundAmount.hasAttribute("readonly")&&!mark.classList.contains("mark_as_sent")){refundAmount.removeAttribute("readonly")}})})})(window._,window.jQuery,window.wc_el_inv_admin);